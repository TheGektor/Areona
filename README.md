# Discord Ticket Bot

Межсерверный Discord-бот с модульной архитектурой и системой тикетов.

## Возможности

- **Два типа тикетов:**
  - **Простые**: создание приватного канала с настраиваемым приветствием
  - **Формы**: сбор ответов на вопросы и отправка в указанный канал

- **Управление доступом:**
  - Настройка доступна только владельцу сервера или назначенным совладельцам
  - Настраиваемые роли с доступом к тикетам

- **Slash-команды** с embed-ответами
- **SQLite база данных** для хранения настроек и данных
- **Модульная архитектура** для легкого расширения

## Установка

1. **Клонируйте репозиторий:**
   ```bash
   git clone <repository-url>
   cd Areona
   ```

2. **Установите зависимости:**
   ```bash
   pip install -r requirements.txt
   ```

3. **Настройте переменные окружения:**
   ```bash
   cp .env.example .env
   ```
   
   Отредактируйте `.env` и добавьте токен вашего бота:
   ```
   DISCORD_TOKEN=your_discord_bot_token_here
   DATABASE_PATH=data/bot.db
   ```

4. **Создайте Discord приложение:**
   - Перейдите на [Discord Developer Portal](https://discord.com/developers/applications)
   - Создайте новое приложение
   - Во вкладке "Bot" создайте бота и скопируйте токен
   - Во вкладке "OAuth2 > URL Generator" выберите:
     - Scopes: `bot`, `applications.commands`
     - Bot Permissions: `Manage Channels`, `Send Messages`, `Embed Links`, `Read Message History`

5. **Запустите бота:**
   ```bash
   python main.py
   ```

## Команды

### Настройка системы (только владелец/совладельцы)

#### `/ticket-setup`
Основная настройка системы тикетов.

**Параметры:**
- `ticket_type`: Тип тикетов (`simple` или `form`)
- `welcome_message`: Приветственное сообщение для новых тикетов
- `target_channel`: Канал для отправки форм (обязательно для типа `form`)

**Пример:**
```
/ticket-setup ticket_type:simple welcome_message:Добро пожаловать в ваш тикет!
```

#### `/ticket-questions`
Настройка вопросов для форм (только для типа `form`).

**Параметры:**
- `questions`: Вопросы, разделенные точкой с запятой (максимум 10)

**Пример:**
```
/ticket-questions questions:Как вас зовут?;Опишите вашу проблему;Когда это произошло?
```

#### `/ticket-roles`
Управление ролями с доступом к тикетам.

**Параметры:**
- `action`: Действие (`add` или `remove`)
- `role`: Роль для добавления/удаления

**Примеры:**
```
/ticket-roles action:add role:@Модераторы
/ticket-roles action:remove role:@Помощники
```

#### `/ticket-status`
Просмотр текущих настроек системы тикетов.

### Управление совладельцами (только владелец сервера)

#### `/add-co-owner`
Добавить совладельца, который может управлять системой тикетов.

**Параметры:**
- `user`: Пользователь для добавления

#### `/remove-co-owner`
Удалить совладельца.

**Параметры:**
- `user`: Пользователь для удаления

#### `/list-co-owners`
Показать список всех совладельцев.

### Пользовательские команды

#### `/ticket`
Создать новый тикет. Тип тикета зависит от настроек сервера.

#### `/close-ticket`
Закрыть текущий тикет (доступно владельцу тикета, персоналу с ролями доступа, или администраторам).

## Архитектура

```
src/
├── adapter/
│   └── discord/
│       ├── bot.py                 # Основной класс бота
│       └── ticket/
│           ├── config/
│           │   └── settings.py    # Настройки и константы
│           ├── database/
│           │   └── models.py      # Управление базой данных
│           ├── domain/
│           │   └── entities.py    # Доменные сущности
│           ├── repository/
│           │   └── ticket_repository.py  # Доступ к данным
│           ├── use_case/
│           │   └── ticket_service.py     # Бизнес-логика
│           ├── utils/
│           │   └── helpers.py     # Вспомогательные функции
│           ├── cogs/
│           │   ├── setup_commands.py     # Команды настройки
│           │   ├── ticket_commands.py    # Команды тикетов
│           │   └── admin_commands.py     # Административные команды
│           └── data/              # Временные данные
```

## Разработка

### Добавление новых команд

1. Создайте новый cog в `src/adapter/discord/ticket/cogs/`
2. Зарегистрируйте cog в `src/adapter/discord/bot.py`
3. Используйте `@app_commands.command` для slash-команд
4. Следуйте паттерну embed-ответов из существующих команд

### Расширение базы данных

1. Добавьте новые таблицы в `database/models.py`
2. Создайте соответствующие сущности в `domain/entities.py`
3. Расширьте repository для работы с новыми данными
4. Обновите use cases для новой функциональности

## Лицензия

MIT License

## Поддержка

При возникновении проблем создайте issue в репозитории проекта.
